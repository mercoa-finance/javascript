/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../../mock-server/MockServerPool";
import { MercoaClient } from "../../../../src/Client";

describe("Bulk", () => {
    test("downloadPayees", async () => {
        const server = mockServerPool.createServer();
        const client = new MercoaClient({ token: "test", xApiVersion: "2024-08-01", environment: server.baseUrl });

        const rawResponseBody = { url: "https://mercoa.com/download/bulk-invoices.csv", mimeType: "text/csv" };
        server
            .mockEndpoint()
            .get("/entity/ent_8545a84e-a45f-41bf-bdf1-33b42a55812c/counterparties/payees/download")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.entity.counterparty.bulk.downloadPayees(
            "ent_8545a84e-a45f-41bf-bdf1-33b42a55812c",
            {
                format: "CSV",
                paymentMethods: true,
                invoiceMetrics: true,
            },
        );
        expect(response).toEqual({
            url: "https://mercoa.com/download/bulk-invoices.csv",
            mimeType: "text/csv",
        });
    });

    test("downloadPayors", async () => {
        const server = mockServerPool.createServer();
        const client = new MercoaClient({ token: "test", xApiVersion: "2024-08-01", environment: server.baseUrl });

        const rawResponseBody = { url: "https://mercoa.com/download/bulk-invoices.csv", mimeType: "text/csv" };
        server
            .mockEndpoint()
            .get("/entity/ent_8545a84e-a45f-41bf-bdf1-33b42a55812c/counterparties/payors/download")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.entity.counterparty.bulk.downloadPayors(
            "ent_8545a84e-a45f-41bf-bdf1-33b42a55812c",
            {
                format: "CSV",
                paymentMethods: true,
                invoiceMetrics: true,
            },
        );
        expect(response).toEqual({
            url: "https://mercoa.com/download/bulk-invoices.csv",
            mimeType: "text/csv",
        });
    });
});
