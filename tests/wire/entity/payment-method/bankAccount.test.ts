/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../../mock-server/MockServerPool";
import { MercoaClient } from "../../../../src/Client";

describe("BankAccount", () => {
    test("initiateMicroDeposits", async () => {
        const server = mockServerPool.createServer();
        const client = new MercoaClient({ token: "test", xApiVersion: "2024-08-01", environment: server.baseUrl });

        const rawResponseBody = {
            id: "pm_4794d597-70dc-4fec-b6ec-c5988e759769",
            type: "bankAccount",
            accountName: "My Checking Account",
            bankName: "Chase",
            routingNumber: "12345678",
            accountNumber: "99988767623",
            accountType: "CHECKING",
            status: "VERIFIED",
            isDefaultSource: true,
            isDefaultDestination: true,
            supportedCurrencies: ["USD"],
            metadata: {},
            frozen: false,
            confirmedByEntity: true,
            createdAt: "2021-01-01T00:00:00Z",
            updatedAt: "2021-01-01T00:00:00Z",
        };
        server
            .mockEndpoint()
            .post(
                "/entity/ent_8545a84e-a45f-41bf-bdf1-33b42a55812c/paymentMethod/pm_4794d597-70dc-4fec-b6ec-c5988e759769/micro-deposits",
            )
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.entity.paymentMethod.bankAccount.initiateMicroDeposits(
            "ent_8545a84e-a45f-41bf-bdf1-33b42a55812c",
            "pm_4794d597-70dc-4fec-b6ec-c5988e759769",
        );
        expect(response).toEqual({
            type: "bankAccount",
            id: "pm_4794d597-70dc-4fec-b6ec-c5988e759769",
            accountName: "My Checking Account",
            bankName: "Chase",
            routingNumber: "12345678",
            accountNumber: "99988767623",
            accountType: "CHECKING",
            status: "VERIFIED",
            isDefaultSource: true,
            isDefaultDestination: true,
            supportedCurrencies: ["USD"],
            metadata: {},
            frozen: false,
            confirmedByEntity: true,
            createdAt: new Date("2021-01-01T00:00:00.000Z"),
            updatedAt: new Date("2021-01-01T00:00:00.000Z"),
        });
    });

    test("completeMicroDeposits", async () => {
        const server = mockServerPool.createServer();
        const client = new MercoaClient({ token: "test", xApiVersion: "2024-08-01", environment: server.baseUrl });
        const rawRequestBody = { amounts: [40, 2] };
        const rawResponseBody = {
            id: "pm_4794d597-70dc-4fec-b6ec-c5988e759769",
            type: "bankAccount",
            accountName: "My Checking Account",
            bankName: "Chase",
            routingNumber: "12345678",
            accountNumber: "99988767623",
            accountType: "CHECKING",
            status: "VERIFIED",
            isDefaultSource: true,
            isDefaultDestination: true,
            supportedCurrencies: ["USD"],
            metadata: {},
            frozen: false,
            confirmedByEntity: true,
            createdAt: "2021-01-01T00:00:00Z",
            updatedAt: "2021-01-01T00:00:00Z",
        };
        server
            .mockEndpoint()
            .put(
                "/entity/ent_8545a84e-a45f-41bf-bdf1-33b42a55812c/paymentMethod/pm_4794d597-70dc-4fec-b6ec-c5988e759769/micro-deposits",
            )
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.entity.paymentMethod.bankAccount.completeMicroDeposits(
            "ent_8545a84e-a45f-41bf-bdf1-33b42a55812c",
            "pm_4794d597-70dc-4fec-b6ec-c5988e759769",
            {
                amounts: [40, 2],
            },
        );
        expect(response).toEqual({
            type: "bankAccount",
            id: "pm_4794d597-70dc-4fec-b6ec-c5988e759769",
            accountName: "My Checking Account",
            bankName: "Chase",
            routingNumber: "12345678",
            accountNumber: "99988767623",
            accountType: "CHECKING",
            status: "VERIFIED",
            isDefaultSource: true,
            isDefaultDestination: true,
            supportedCurrencies: ["USD"],
            metadata: {},
            frozen: false,
            confirmedByEntity: true,
            createdAt: new Date("2021-01-01T00:00:00.000Z"),
            updatedAt: new Date("2021-01-01T00:00:00.000Z"),
        });
    });
});
